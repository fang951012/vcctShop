webpackJsonp([2],{"2UAW":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),o=s.n(i),a=s("ergL"),n=s("K31e"),l=s("Au9i"),r={name:"integral",components:{common:a.a,login:n.a},data:function(){return{isActive:!0,title:{title:"积分兑换",rightTitle:"兑换记录"},aReal:[],aVirtual:[],nReal:2,nVirtual:2,allReal:!1,bottomPullText1:"上拉加载更多",allVirtual:!1,bottomPullText2:"上拉加载更多",showLogin:!1,csrf:"",isLogin:!1,isApp:!1,virtualNum:0}},created:function(){var t=this;t.getList(3,1),t.judgeApp(),t.login()},methods:{judgeApp:function(){var t=this,e=navigator.userAgent,s=-1!=e.indexOf("iPhone");if(-1!=e.indexOf("damailicai_app")){if(t.isApp=!0,s){try{JIClient.appSetHead({showBack:!0,title:"积分兑换",right:"记录"})}catch(t){}}else try{JIClient.appSetHead(!0,"积分兑换","记录")}catch(t){}window.appRight=t.right}else t.isApp=!1},right:function(){location.href="/shop/index#/history"},goLogin:function(){var t=navigator.userAgent;if(-1!=t.indexOf("damailicai_app")){if(t.split("damailicai_app/")[1].split(";")[0]<"3.2.0")if(-1!=t.indexOf("iPhone"))quicklogin(url);else try{JIClient.appClose(),JIClient.appLogin()}catch(t){}else try{JIClient.appLogin()}catch(t){}return!1}this.showLogin=!0},getCsrf:function(){this.csrf=document.getElementsByName("csrf-token")[0].content},rightClick:function(){var t=this;t.isLogin?(t.$router.push("/history"),_hmt.push(["_trackEvent","跳转兑换记录","click","dhlb-dhjl"])):t.showLogin=!0},goHistory:function(){var t=this;t.isLogin?t.$router.push("/history"):t.showLogin=!0},ret:function(){window.history.length>1?this.$router.go(-1):this.$router.push("/")},realBottom:function(){l.Indicator.open({text:"Loading...",spinnerType:"fading-circle"});var t=this;t.getCsrf();var e=new FormData;e.append("kind",1),e.append("page",t.nReal),t.$http.post("/shop/getlist",e,{headers:{"X-CSRF-Token":t.csrf}}).then(function(e){if("0"==(e=e.data).statusCode){e.content.total<=10*t.nReal?(t.allReal=!0,t.bottomPullText1="没有更多了哦"):(t.allReal=!1,t.nReal++);for(var s=e.content.list,i=0;i<s.length&&s[i].seller_price!=s[i].show_price;i++)s[i].discount_rate=Math.floor(100*Number(s[i].seller_price)/Number(s[i].show_price))/10;for(var o=0;o<s.length;o++)t.aReal.push(s[o]);t.$refs.loadmore1.onBottomLoaded()}l.Indicator.close()}).catch(function(e){console.log(e),t.$refs.loadmore1.onBottomLoaded()})},virBottom:function(){l.Indicator.open({text:"Loading...",spinnerType:"fading-circle"});var t=this;t.getCsrf();var e=new FormData;e.append("kind",3),e.append("page",t.nVirtual),t.$http.post("/shop/getlist",e,{headers:{"X-CSRF-Token":t.csrf}}).then(function(e){if("0"==(e=e.data).statusCode){e.content.total<=10*t.nVirtual?(t.allVirtual=!0,t.bottomPullText2="没有更多了哦"):(t.allVirtual=!1,t.nVirtual++);for(var s=e.content.list,i=0;i<s.length&&s[i].seller_price!=s[i].show_price;i++)s[i].discount_rate=Math.floor(100*Number(s[i].seller_price)/Number(s[i].show_price))/10;for(var o=0;o<s.length;o++)t.aVirtual.push(s[o]);t.$refs.loadmore2.onBottomLoaded()}l.Indicator.close()}).catch(function(e){console.log(e),t.$refs.loadmore2.onBottomLoaded()})},login:function(){var t=this;t.getCsrf(),t.$http.post("/shop/is-login",{},{headers:{"X-CSRF-Token":t.csrf}}).then(function(e){0==(e=e.data).statusCode&&(t.isLogin=!0)}).catch(function(t){console.log(t)})},loginSuccess:function(){var t=this;t.showLogin=!1,t.isLogin=!0,t.getList(3,1)},closeLogin:function(){this.showLogin=!1},goIntegral:function(){var t=this;t.isLogin?t.$router.push("/integral"):t.showLogin=!0},goEntity:function(){var t=this;t.allVirtual=!1,t.allReal=!1,t.nReal=2,t.getList(1,1)},goVirtual:function(){var t=this;t.allVirtual=!1,t.allReal=!1,t.nVirtual=2,t.getList(3,1)},update:function(t){return JSON.parse(o()(t))},saveNum:function(t){this.virtualNum=t,localStorage.setItem("virtualNum",t)},getList:function(t,e){l.Indicator.open({text:"Loading...",spinnerType:"fading-circle"});var s=this;s.getCsrf();var i=new FormData;i.append("kind",t),i.append("page",e),s.$http.post("/shop/getlist",i,{headers:{"X-CSRF-Token":s.csrf}}).then(function(e){if("0"==(e=e.data).statusCode)if(e.content.virtual_money&&s.saveNum(e.content.virtual_money),1==t){e.content.total<=10&&(s.allReal=!0,s.bottomPullText1="没有更多了哦");for(var i=e.content.list,o=0;o<i.length&&i[o].seller_price!=i[o].show_price;o++)i[o].discount_rate=Math.floor(100*Number(i[o].seller_price)/Number(i[o].show_price))/10;s.aReal=i,s.isActive=!1}else{e.content.total<=10&&(s.allVirtual=!0,s.bottomPullText2="没有更多了哦");for(i=e.content.list,o=0;o<i.length&&i[o].seller_price!=i[o].show_price;o++)i[o].discount_rate=Math.floor(100*Number(i[o].seller_price)/Number(i[o].show_price))/10;s.aVirtual=i,s.isActive=!0}l.Indicator.close()}).catch(function(t){console.log(t)})}}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"exchange"}},[s("div",{staticClass:"cont"},[t.isApp?t._e():s("common",{attrs:{title:t.title.title,rightTitle:t.title.rightTitle},on:{"right-click":t.rightClick}}),t._v(" "),s("nav",{class:{top:t.isApp}},[s("a",{class:{active:t.isActive},attrs:{href:"javascript:void(0)",onclick:"_hmt.push(['_trackEvent', '积分兑换-虚拟产品', 'click', 'dhlb-xnlp'])"},on:{click:t.goVirtual}},[t._v("虚拟礼品")]),t._v(" "),s("a",{class:{active:!t.isActive},attrs:{href:"javascript:void(0)",onclick:"_hmt.push(['_trackEvent', '积分兑换-实物周边', 'click', 'dhlb-swzb'])"},on:{click:t.goEntity}},[t._v("实物周边")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isActive,expression:"!isActive"}],staticClass:"list-box"},[s("mt-loadmore",{ref:"loadmore1",attrs:{"bottom-method":t.realBottom,"bottom-all-loaded":t.allReal,autoFill:!1,bottomPullText:t.bottomPullText1}},[s("ul",t._l(t.aReal,function(e){return s("li",[s("div",{staticClass:"clear"},[s("a",{attrs:{href:"#/detail?id="+e.goods_id}},[0==e.stocks?s("div",{staticClass:"sold-out"},[s("div",{staticClass:"sold-icon"})]):t._e(),t._v(" "),e.discount_rate?s("span",{staticClass:"discount-icon"},[s("p",[t._v(t._s(e.discount_rate))]),s("p",[t._v("折")])]):t._e(),t._v(" "),s("img",{attrs:{src:e.thum_img}}),t._v(" "),1==e.hot?s("span",{staticClass:"foot-icon"},[t._v("热销")]):t._e()])]),t._v(" "),s("h3",[t._v(t._s(e.title))]),t._v(" "),s("p",[s("span",{staticClass:"integral-icon"}),t._v(" "),s("span",{staticClass:"num"},[t._v(t._s(e.seller_price))]),t._v(" "),s("span",[t._v("积分")])])])}))])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"list-box"},[s("mt-loadmore",{ref:"loadmore2",attrs:{"bottom-method":t.virBottom,"bottom-all-loaded":t.allVirtual,autoFill:!1,bottomPullText:t.bottomPullText2}},[s("ul",t._l(t.aVirtual,function(e){return s("li",[s("div",{staticClass:"clear"},[s("a",{attrs:{href:"#/detail?id="+e.goods_id}},[0==e.stocks?s("div",{staticClass:"sold-out"},[s("div",{staticClass:"sold-icon"})]):t._e(),t._v(" "),e.discount_rate?s("span",{staticClass:"discount-icon"},[s("p",[t._v(t._s(e.discount_rate))]),s("p",[t._v("折")])]):t._e(),t._v(" "),s("img",{attrs:{src:e.thum_img}}),t._v(" "),1==e.hot?s("span",{staticClass:"foot-icon"},[t._v("热销")]):t._e()])]),t._v(" "),s("h3",[t._v(t._s(e.title))]),t._v(" "),s("p",[s("span",{staticClass:"integral-icon"}),t._v(" "),s("span",{staticClass:"num"},[t._v(t._s(e.seller_price))]),t._v(" "),s("span",[t._v("积分")])])])}))])],1)],1),t._v(" "),s("footer",[s("span",[s("span",[t._v("我的积分")]),t._v(" "),t.isLogin?s("span",{staticClass:"num",domProps:{textContent:t._s(t.virtualNum)}}):s("span",{staticClass:"num",on:{click:t.goLogin}},[t._v("登录查看")])]),t._v(" "),s("a",{attrs:{href:"javascript:void(0)",onclick:"_hmt.push(['_trackEvent', '积分兑换-积分记录', 'click', 'dhlb-jfjl'])"},on:{click:t.goIntegral}},[t._v("积分记录")])]),t._v(" "),s("login",{directives:[{name:"show",rawName:"v-show",value:t.showLogin,expression:"showLogin"}],on:{"close-login":t.closeLogin,"login-success":t.loginSuccess}})],1)},staticRenderFns:[]};var u=s("VU/8")(r,c,!1,function(t){s("nr3t")},null,null);e.default=u.exports},K31e:function(t,e,s){"use strict";var i=s("Au9i"),o={name:"login",data:function(){return{userName:"",passWord:"",csrf:""}},created:function(){},methods:{getCsrf:function(){this.csrf=document.getElementsByName("csrf-token")[0].content},close:function(){this.$emit("close-login")},login:function(){var t=this;if(!t.userName||!t.passWord)return Object(i.MessageBox)({title:"温馨提示",message:"请输入账号密码"}),!1;t.getCsrf();var e=new FormData;e.append("userName",t.userName),e.append("password",t.passWord),e.append("type","quick_login"),t.$http.post("/home/login",e,{headers:{"Content-Type":"multipart/form-data","X-CSRF-Token":t.csrf}}).then(function(e){0==(e=e.data).statusCode?t.$emit("login-success"):Object(i.MessageBox)({title:"温馨提示",message:e.message})}).catch(function(t){Object(i.MessageBox)({title:"温馨提示",message:"系统繁忙，请稍后再试"})})}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mask",attrs:{id:"login"}},[s("div",{staticClass:"mask-cont login-box"},[s("div",{staticClass:"title"},[s("span",{staticClass:"tipsclose",on:{click:t.close}},[t._v("×")]),t._v("快速登录")]),t._v(" "),s("div",{staticClass:"form_ctrl"},[s("div",{staticClass:"group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.userName,expression:"userName"}],attrs:{type:"text",name:"userName",placeholder:"请输入手机号码/用户名",autocomplete:"off"},domProps:{value:t.userName},on:{input:function(e){e.target.composing||(t.userName=e.target.value)}}})]),t._v(" "),s("div",{staticClass:"group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.passWord,expression:"passWord"}],attrs:{type:"password",name:"password",placeholder:"请输入登录密码",autocomplete:"off"},domProps:{value:t.passWord},on:{input:function(e){e.target.composing||(t.passWord=e.target.value)}}})]),t._v(" "),t._m(0),t._v(" "),s("a",{staticClass:"box_btn login_btn",attrs:{href:"javascript:void(0)"},on:{click:t.login}},[t._v("登录")])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"other_info"},[e("a",{attrs:{href:"/home/resetpw"}},[this._v("找回密码")]),this._v(" "),e("a",{staticClass:"rt",attrs:{href:"/home/reg",id:""}},[this._v("注册专享红包")])])}]};var n=s("VU/8")(o,a,!1,function(t){s("cGsX")},null,null);e.a=n.exports},cGsX:function(t,e){},nr3t:function(t,e){}});