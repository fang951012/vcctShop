webpackJsonp([2],{CWi1:function(t,e){},uZco:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("ergL"),s=i("K31e"),o=i("Au9i"),a=i("PJh5"),l=i.n(a),r={name:"integral-history",components:{common:n.a,login:s.a},data:function(){return{title:"我的积分",rightTitle:"积分规则",isApp:!1,isLogin:!0,showLogin:!1,csrf:"",lists:[],virtual_money:0,left:0,next_year:"1970-01-01",count:0,type:"all",page:0,total:0,busy:!1,loadingShow:!0,loadMoreHide:!1,loadingText:"加载中..."}},created:function(){var t=this;t.judgeApp(),t.login(),t.loadMore()},methods:{judgeApp:function(){var t=this,e=navigator.userAgent,i=-1!=e.indexOf("iPhone");if(-1!=e.indexOf("damailicai_app")){if(t.isApp=!0,i){try{JIClient.appSetHead({showBack:!0,title:"我的积分",right:"积分规则"})}catch(t){}}else try{JIClient.appSetHead(!0,"我的积分","积分规则")}catch(t){}window.appRight=t.appRight}else t.isApp=!1},appRight:function(){this.isLogin?window.location.href="/shop/index#/rule":this.goLogin()},rightClick:function(){this.$router.push("/rule"),_hmt.push(["_trackEvent","积分规则","click","dhlb-jfgz"])},goLogin:function(){var t=navigator.userAgent;if(-1!=t.indexOf("damailicai_app")){if(t.split("damailicai_app/")[1].split(";")[0]<"3.2.0")if(-1!=t.indexOf("iPhone"))quicklogin(url);else try{JIClient.appClose(),JIClient.appLogin()}catch(t){}else try{JIClient.appLogin()}catch(t){}return!1}this.showLogin=!0},login:function(){var t=this;t.getCsrf(),t.$http.post("/shop/is-login",{},{headers:{"X-CSRF-Token":t.csrf}}).then(function(e){0==(e=e.data).statusCode?t.isLogin=!0:(t.isLogin=!1,t.showLogin=!0)}).catch(function(t){Object(o.MessageBox)({title:"温馨提示",message:"系统繁忙，请稍后再试！"})})},loginSuccess:function(){var t=this;t.showLogin=!1,t.isLogin=!0,t.loadMore()},closeLogin:function(){this.showLogin=!1},changeActive:function(t){var e=this;e.type=t,e.page=1,e.loadingText="加载中...",e.getList(t,e.page,10)},getCsrf:function(){this.csrf=document.getElementsByName("csrf-token")[0].content},loadMore:function(){var t=this;if(!t.isLogin)return!1;t.busy=!0,t.loadingText="加载中...",t.page++,t.getList(t.type,t.page,10)},getList:function(t,e,i){o.Indicator.open({text:"Loading...",spinnerType:"fading-circle"});var n=this;1==e&&(n.lists=[]);var s=new FormData;s.append("type",t),s.append("page",e),s.append("pageSize",i),n.$http.post("/shop/credit-list",s,{headers:{"X-CSRF-Token":n.csrf,"Content-Type":"multipart/form-data"}}).then(function(t){if("0"==(t=t.data).statusCode){n.virtual_money=t.content.virtual_money,n.left=t.content.left,n.next_year=t.content.next_year,n.count=t.content.count,n.total=t.content.total;for(var e=0;e<t.content.list.length;e++)n.lists.push(t.content.list[e]);if(n.total<=10*n.page)return n.loadingText="—— 我是有底线的列表 ——",o.Indicator.close(),!1;n.loadingText="下拉加载更多"}else Object(o.MessageBox)({title:"温馨提示",message:t.message});n.busy=!1,o.Indicator.close()}).catch(function(t){Object(o.MessageBox)({title:"温馨提示",message:"系统繁忙，请稍后再试！"})})}},filters:{format_timestamp:function(t,e){return l.a.unix(t).format(e||"YYYY-MM-DD HH:mm:ss")},format_date:function(t,e){return l()(t).format(e||"YYYY-MM-DD HH:mm:ss")}}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"in-history"}},[t.isApp?t._e():i("common",{attrs:{title:t.title,rightTitle:t.rightTitle},on:{"right-click":t.rightClick}}),t._v(" "),i("nav",{class:["nav",{top:t.isApp}]},[i("ul",{staticClass:"type"},[i("li",{class:{active:"all"==t.type},on:{click:function(e){t.changeActive("all")}}},[t._v("全部")]),t._v(" "),i("li",{class:{active:"in"==t.type},on:{click:function(e){t.changeActive("in")}}},[t._v("获取记录")]),t._v(" "),i("li",{class:{active:"out"==t.type},on:{click:function(e){t.changeActive("out")}}},[t._v("消耗记录")])])]),t._v(" "),i("div",{staticClass:"tab"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"all"==t.type,expression:"type=='all'"}],staticClass:"num-head all"},[i("p",{staticClass:"mark"},[t._v("—— 可用积分："),i("span",{domProps:{textContent:t._s(t.virtual_money)}}),t._v(" ——")]),t._v(" "),i("p",[i("span",{domProps:{textContent:t._s(t.left)}},[t._v("0")]),t._v("积分将于"),i("span",{domProps:{textContent:t._s(t.$options.filters.format_date(t.next_year,"YYYY-MM-DD"))}}),t._v("过期，及时用掉别浪费")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"in"==t.type,expression:"type=='in'"}],staticClass:"num-head obtain"},[i("div",[t._v("—— "),i("span",[t._v("已获取积分：")]),i("span",{domProps:{textContent:t._s(t.count)}}),t._v(" ——")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"out"==t.type,expression:"type=='out'"}],staticClass:"num-head consume"},[i("div",[t._v("—— "),i("span",[t._v("已消耗积分：")]),i("span",{domProps:{textContent:t._s(t.count)}}),t._v(" ——")])])]),t._v(" "),i("div",{staticClass:"list-box"},[i("ul",t._l(t.lists,function(e,n){return i("li",[i("div",{staticClass:"detail"},[i("p",{domProps:{textContent:t._s(e.remark)}}),t._v(" "),i("p",{staticClass:"time",domProps:{textContent:t._s(t.$options.filters.format_timestamp(e.addtime,"YYYY-MM-DD HH:mm:ss"))}})]),t._v(" "),i("div",[e.extcredits>0?i("p",{staticClass:"add",domProps:{textContent:t._s("+"+e.extcredits)}}):i("p",{staticClass:"reduce",domProps:{textContent:t._s(e.extcredits)}})])])})),t._v(" "),i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],class:t.loadMoreHide?"load-more-hide":"load-more-normal",attrs:{"infinite-scroll-disabled":"busy","infinite-scroll-distance":"4"}},[i("span",{directives:[{name:"show",rawName:"v-show",value:t.loadingShow,expression:"loadingShow"}],domProps:{textContent:t._s(t.loadingText)}})])]),t._v(" "),i("login",{directives:[{name:"show",rawName:"v-show",value:t.showLogin,expression:"showLogin"}],on:{"close-login":t.closeLogin,"login-success":t.loginSuccess}}),t._v(" "),i("input",{attrs:{type:"hidden",name:"starttime"},domProps:{value:t.$moment("20181205").format("YYYY-MM-DD HH:mm:ss")}})],1)},staticRenderFns:[]};var p=i("VU/8")(r,c,!1,function(t){i("CWi1")},null,null);e.default=p.exports}});